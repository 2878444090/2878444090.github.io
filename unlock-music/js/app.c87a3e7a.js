(function(e){function t(t){for(var r,o,c=t[0],s=t[1],u=t[2],f=0,m=[];f<c.length;f++)o=c[f],Object.prototype.hasOwnProperty.call(a,o)&&a[o]&&m.push(a[o][0]),a[o]=0;for(r in s)Object.prototype.hasOwnProperty.call(s,r)&&(e[r]=s[r]);l&&l(t);while(m.length)m.shift()();return i.push.apply(i,u||[]),n()}function n(){for(var e,t=0;t<i.length;t++){for(var n=i[t],r=!0,c=1;c<n.length;c++){var s=n[c];0!==a[s]&&(r=!1)}r&&(i.splice(t--,1),e=o(o.s=n[0]))}return e}var r={},a={app:0},i=[];function o(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.m=e,o.c=r,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)o.d(n,r,function(t){return e[t]}.bind(null,r));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="";var c=window["webpackJsonp"]=window["webpackJsonp"]||[],s=c.push.bind(c);c.push=t,c=c.slice();for(var u=0;u<c.length;u++)t(c[u]);var l=s;i.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("56d7")},"034f":function(e,t,n){"use strict";var r=n("64a9"),a=n.n(r);a.a},1:function(e,t){},1020:function(e,t,n){"use strict";n.r(t),n.d(t,"Decrypt",function(){return l});var r=n("768b"),a=(n("a481"),n("6b54"),n("ac6a"),n("34ef"),n("96cf"),n("3b8d")),i=n("3452"),o=n("7907"),c=i.enc.Hex.parse("687a4852416d736f356b496e62617857"),s=i.enc.Hex.parse("2331346C6A6B5F215C5D2630553C2728"),u={mp3:"audio/mpeg",flac:"audio/flac"};function l(e){return f.apply(this,arguments)}function f(){return f=Object(a["a"])(regeneratorRuntime.mark(function e(t){var n,a,l,f,m,d,p,b,h,g,v,y,w,k,x,_,O,U,R,j,A,L;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,new Promise(function(e){var n=new FileReader;n.onload=function(t){e(t.target.result)},n.readAsArrayBuffer(t)});case 2:if(n=e.sent,a=new DataView(n),1313166403===a.getUint32(0,!0)&&1296122950===a.getUint32(4,!0)){e.next=6;break}return e.abrupt("return",{status:!1,message:"此ncm文件已损坏"});case 6:for(l=10,f=function(){var e=a.getUint32(l,!0);l+=4;var t=new Uint8Array(n,l,e).map(function(e){return 100^e});l+=e;for(var r=i.AES.decrypt({ciphertext:i.lib.WordArray.create(t)},c,{mode:i.mode.ECB,padding:i.pad.Pkcs7}),o=new Uint8Array(r.sigBytes),s=r.words,u=r.sigBytes,f=0;f<u;f++)o[f]=s[f>>>2]>>>24-f%4*8&255;return o.slice(17)}(),m=function(){for(var e=new Uint8Array(Array(256).keys()),t=f.length,n=0,r=0;r<256;r++){n=e[r]+n+f[r%t]&255;var a=[e[n],e[r]];e[r]=a[0],e[n]=a[1]}return e.map(function(e,t,n){t=t+1&255;var r=n[t],a=n[t+r&255];return n[r+a&255]})}(),d=function(){var e=a.getUint32(l,!0);if(l+=4,0===e)return{};var t=new Uint8Array(n,l,e).map(function(e){return 99^e});l+=e;var r=i.AES.decrypt({ciphertext:i.enc.Base64.parse(i.lib.WordArray.create(t.slice(22)).toString(i.enc.Utf8))},s,{mode:i.mode.ECB,padding:i.pad.Pkcs7}),o=JSON.parse(r.toString(i.enc.Utf8).slice(6));return o.albumPic=o.albumPic.replace("http:","https:"),o}(),l+=a.getUint32(l+5,!0)+13,p=new Uint8Array(n,l),b=p.length,h=0;h<b;++h)p[h]^=m[255&h];if(void 0===d.format&&(g=p,v=Object(r["a"])(g,4),y=v[0],w=v[1],k=v[2],x=v[3],d.format=102===y&&76===w&&97===k&&67===x?"flac":"mp3"),_=u[d.format],O=[],d.artist.forEach(function(e){O.push(e[0])}),"mp3"!==d.format){e.next=36;break}if(U=new o(p),U.setFrame("TPE1",O).setFrame("TIT2",d.musicName).setFrame("TALB",d.album),""===d.albumPic){e.next=34;break}return e.prev=22,e.next=25,fetch(d.albumPic);case 25:return e.next=27,e.sent.arrayBuffer();case 27:R=e.sent,U.setFrame("APIC",{type:3,data:R,description:"Cover"}),e.next=34;break;case 31:e.prev=31,e.t0=e["catch"](22),console.log("Fail to write cover image!");case 34:U.addTag(),p=U.arrayBuffer;case 36:return j=new Blob([p],{type:_}),A=URL.createObjectURL(j),L=O.join(" & ")+" - "+d.musicName+"."+d.format,e.abrupt("return",{status:!0,filename:L,title:d.musicName,artist:O.join(" & "),album:d.album,picture:d.albumPic,file:A,mime:_});case 40:case"end":return e.stop()}},e,null,[[22,31]])})),f.apply(this,arguments)}},2:function(e,t){},"56d7":function(e,t,n){"use strict";n.r(t);n("cadf"),n("551c"),n("f751"),n("097d");var r=n("2b0e"),a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"app"}},[n("el-container",[n("el-main",[n("el-upload",{attrs:{"auto-upload":!1,"on-change":e.handleFile,"show-file-list":!1,accept:".ncm,.qmc0,.qmc3,.qmcflac,.qmcogg,.mflac",action:"",drag:"",multiple:""}},[n("i",{staticClass:"el-icon-upload"}),n("div",{staticClass:"el-upload__text"},[e._v("将文件拖到此处，或"),n("em",[e._v("点击选择")])]),n("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[e._v("本工具仅在浏览器内对文件进行解锁，无需消耗流量")])]),n("el-row",{attrs:{id:"app-control"}},[n("el-button",{attrs:{icon:"el-icon-download",plain:""},on:{click:e.handleDownloadAll}},[e._v("下载全部")]),n("el-button",{attrs:{icon:"el-icon-delete",plain:"",type:"danger"},on:{click:e.handleDeleteAll}},[e._v("删除全部")])],1),n("audio",{attrs:{autoplay:e.playing_auto,src:e.playing_url,controls:""}}),n("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData}},[n("el-table-column",{attrs:{label:"封面"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-image",{staticStyle:{width:"100px",height:"100px"},attrs:{src:t.row.picture}},[n("div",{staticClass:"image-slot el-image__error",attrs:{slot:"error"},slot:"error"},[e._v("\n                                暂无封面\n                            ")])])]}}])}),n("el-table-column",{attrs:{label:"歌曲",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){return[n("span",{staticStyle:{"margin-left":"10px"}},[e._v(e._s(t.row.title))])]}}])}),n("el-table-column",{attrs:{label:"歌手",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){return[n("p",[e._v(e._s(t.row.artist))])]}}])}),n("el-table-column",{attrs:{label:"专辑",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){return[n("p",[e._v(e._s(t.row.album))])]}}])}),n("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-button",{attrs:{circle:"",icon:"el-icon-video-play",type:"success"},on:{click:function(n){return e.handlePlay(t.$index,t.row)}}}),n("el-button",{attrs:{circle:"",icon:"el-icon-download"},on:{click:function(n){return e.handleDownload(t.row)}}}),n("el-button",{attrs:{circle:"",icon:"el-icon-delete",type:"danger"},on:{click:function(n){return e.handleDelete(t.$index,t.row)}}})]}}])})],1)],1),n("el-footer",{attrs:{id:"app-footer"}},[n("el-row",[e._v("\n                音乐解锁：移除已购音乐的加密保护。\n                目前支持网易云音乐(ncm)和QQ音乐(qmc0, qmc3, qmcflac, qmcogg, mflac)。\n                "),n("a",{attrs:{href:"https://github.com/ix64/unlock-music/wiki/使用提示",target:"_blank"}},[e._v("使用提示")])]),n("el-row",[n("span",[e._v("Copyright © 2019")]),n("a",{attrs:{href:"https://github.com/ix64",target:"_blank"}},[e._v("MengYX")]),e._v("\n                音乐解锁使用\n                "),n("a",{attrs:{href:"https://github.com/ix64/unlock-music/blob/master/LICENSE",target:"_blank"}},[e._v("MIT许可协议")]),e._v("\n                开放\n                "),n("a",{attrs:{href:"https://github.com/ix64/unlock-music",target:"_blank"}},[e._v("源代码")])])],1)],1)],1)},i=[],o=(n("ac6a"),n("96cf"),n("3b8d")),c=(n("7f7f"),n("1020")),s=n("d26a"),u=n("b5de"),l=n("5fa2"),f={name:"app",components:{},data:function(){return{activeIndex:"1",tableData:[],playing_url:"",playing_auto:!1}},mounted:function(){this.$nextTick(function(){this.finishLoad()})},methods:{finishLoad:function(){document.getElementById("loader-mask").remove(),this.$notify.info({title:"离线使用",message:'我们使用PWA技术，无网络也能使用<br/>最近更新：支持qmcogg,mflac<br/>点击查看 <a target="_blank" href="https://github.com/ix64/unlock-music/wiki/使用提示">使用提示</a>',dangerouslyUseHTMLString:!0,duration:1e4,position:"top-left"})},handleFile:function(e){var t=this,n=e.name.substring(e.name.lastIndexOf(".")+1,e.name.length).toLowerCase();Object(o["a"])(regeneratorRuntime.mark(function r(){var a,i;return regeneratorRuntime.wrap(function(r){while(1)switch(r.prev=r.next){case 0:a=null,r.t0=n,r.next="ncm"===r.t0?4:"mp3"===r.t0?8:"flac"===r.t0?8:"qmc3"===r.t0?12:"qmc0"===r.t0?12:"qmcflac"===r.t0?12:"qmcogg"===r.t0?12:"mflac"===r.t0?16:20;break;case 4:return r.next=6,c.Decrypt(e.raw);case 6:return a=r.sent,r.abrupt("break",22);case 8:return r.next=10,u.Decrypt(e.raw);case 10:return a=r.sent,r.abrupt("break",22);case 12:return r.next=14,s.Decrypt(e.raw);case 14:return a=r.sent,r.abrupt("break",22);case 16:return r.next=18,l.Decrypt(e.raw);case 18:return a=r.sent,r.abrupt("break",22);case 20:return a={status:!1,message:"不支持此文件格式"},r.abrupt("break",22);case 22:a.status?(t.tableData.push(a),t.$notify.success({title:"解锁成功",message:"成功解锁 "+a.title,duration:3e3}),i=[a.title,a.artist,a.album],console.log(a),window._paq.push(["trackEvent","Unlock",n+","+a.mime,JSON.stringify(i)])):(t.$notify.error({title:"出现问题",message:a.message+"，"+e.name+'，参考<a target="_blank" href="https://github.com/ix64/unlock-music/wiki/使用提示">使用提示</a>',dangerouslyUseHTMLString:!0,duration:6e3}),window._paq.push(["trackEvent","Error",a.message,e.name]));case 23:case"end":return r.stop()}},r)}))()},handlePlay:function(e,t){this.playing_url=t.file,this.playing_auto=!0},handleDelete:function(e,t){console.log(e),URL.revokeObjectURL(t.file),URL.revokeObjectURL(t.picture),this.tableData.splice(e,1)},handleDownload:function(e){var t=document.createElement("a");t.href=e.file,t.download=e.filename,document.body.append(t),t.click(),t.remove()},handleDeleteAll:function(){this.tableData.forEach(function(e){URL.revokeObjectURL(e.file),URL.revokeObjectURL(e.picture)}),this.tableData=[]},handleDownloadAll:function(){var e=this,t=0,n=setInterval(function(){t<e.tableData.length?(e.handleDownload(e.tableData[t]),t++):clearInterval(n)},1e3)}}},m=f,d=(n("034f"),n("2877")),p=Object(d["a"])(m,a,i,!1,null,null,null),b=p.exports,h=n("9483");Object(h["a"])("".concat("","service-worker.js"),{ready:function(){console.log("App is being served from cache by a service worker.\nFor more details, visit https://goo.gl/AFskqB")},registered:function(){console.log("Service worker has been registered.")},cached:function(){console.log("Content has been cached for offline use.")},updatefound:function(){console.log("New content is downloading.")},updated:function(){console.log("New content is available; please refresh.")},offline:function(){console.log("No internet connection found. App is running in offline mode.")},error:function(e){console.error("Error during service worker registration:",e)}});var g=n("5c96");n("0fae");r["default"].use(g["Link"]),r["default"].use(g["Image"]),r["default"].use(g["Button"]),r["default"].use(g["Table"]),r["default"].use(g["TableColumn"]),r["default"].use(g["Main"]),r["default"].use(g["Footer"]),r["default"].use(g["Container"]),r["default"].use(g["Icon"]),r["default"].use(g["Row"]),r["default"].use(g["Col"]),r["default"].use(g["Upload"]),r["default"].prototype.$notify=g["Notification"],r["default"].config.productionTip=!1,new r["default"]({render:function(e){return e(b)}}).$mount("#app")},"5fa2":function(e,t,n){"use strict";n.r(t),n.d(t,"Decrypt",function(){return s});n("28a5"),n("34ef"),n("7f7f"),n("96cf"),n("6c7b");var r=n("d225"),a=n("b0b4"),i=n("bd86"),o=n("3b8d"),c=n("cb96");function s(e){return u.apply(this,arguments)}function u(){return u=Object(o["a"])(regeneratorRuntime.mark(function e(t){var n,r,a,i,o,s,u,f,m,d,p,b,h,g,v,y;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(n=t.name.substring(t.name.lastIndexOf(".")+1,t.name.length).toLowerCase(),"mflac"===n){e.next=3;break}return e.abrupt("return",{status:!1,message:"File type is incorrect!"});case 3:return e.next=5,new Promise(function(e){var n=new FileReader;n.onload=function(t){e(t.target.result)},n.readAsArrayBuffer(t)});case 5:if(r=e.sent,a=new Uint8Array(r.slice(0,-368)),i=a.length,o=new l,o.DetectMask(a)){e.next=11;break}return e.abrupt("return",{status:!1,message:"此音乐无法解锁，目前mflac格式不提供完整支持"});case 11:for(s=0;s<i;++s)a[s]^=o.NextMask();return u=new Blob([a],{type:"audio/flac"}),f=URL.createObjectURL(u),e.next=16,c.parseBlob(u);case 16:return m=e.sent,d=t.name.substring(0,t.name.lastIndexOf(".")).split("-"),p=m.common.title,b=m.common.artist,d.length>1?(void 0===b&&(b=d[0].trim()),void 0===p&&(p=d[1].trim())):1===d.length&&void 0===p&&(p=d[0].trim()),h=b+" - "+p+".flac",g="",void 0!==m.common.picture&&m.common.picture.length>=1&&(v=m.common.picture[0],y=new Blob([v.data],{type:v.format}),g=URL.createObjectURL(y)),e.abrupt("return",{status:!0,message:"",filename:h,title:p,artist:b,album:m.common.album,picture:g,file:f,mime:"audio/flac"});case 25:case"end":return e.stop()}},e)})),u.apply(this,arguments)}var l=function(){function e(){Object(r["a"])(this,e),Object(i["a"])(this,"FLAC_HEADER",[102,76,97,67,0]),this.index=-1,this.mask_index=-1,this.mask=Array(128).fill(0)}return Object(a["a"])(e,[{key:"DetectMask",value:function(e){for(var t,n=e.length-256,r=0;r<n;r+=128){var a=!0;t=e.slice(r,r+128);for(var i=e.slice(r+128,r+256),o=0;o<128;o++)if(t[o]!==i[o]){a=!1;break}if(a){for(var c=0;c<this.FLAC_HEADER.length;c++){var s=e[c]^t[c];if(s!==this.FLAC_HEADER[c]){a=!1;break}}if(a)return this.mask=t,!0}}return!1}},{key:"NextMask",value:function(){return this.index++,this.mask_index++,(32768===this.index||this.index>32768&&(this.index+1)%32768===0)&&(this.index++,this.mask_index++),this.mask_index>=128&&(this.mask_index-=128),this.mask[this.mask_index]}}]),e}()},"64a9":function(e,t,n){},b5de:function(e,t,n){"use strict";n.r(t),n.d(t,"Decrypt",function(){return o});n("28a5"),n("7f7f"),n("96cf");var r=n("3b8d"),a=n("cb96"),i={mp3:"audio/mpeg",flac:"audio/flac"};function o(e){return c.apply(this,arguments)}function c(){return c=Object(r["a"])(regeneratorRuntime.mark(function e(t){var n,r,o,c,s,u,l,f,m,d,p;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,a.parseBlob(t);case 2:return n=e.sent,r="",void 0!==n.common.picture&&n.common.picture.length>0&&(o=new Blob([n.common.picture[0].data],{type:n.common.picture[0].format}),r=URL.createObjectURL(o)),c=URL.createObjectURL(t),s=t.name.substring(0,t.name.lastIndexOf(".")),u=s.split("-"),l=t.name.substring(t.name.lastIndexOf(".")+1,t.name.length).toLowerCase(),f=i[l],m=n.common.title,d=n.common.artist,u.length>1?(void 0===d&&(d=u[0].trim()),void 0===m&&(m=u[1].trim())):1===u.length&&void 0===m&&(m=u[0].trim()),p=d+" - "+m+"."+l,e.abrupt("return",{status:!0,filename:p,title:m,artist:d,album:n.common.album,picture:r,file:c,mime:f});case 15:case"end":return e.stop()}},e)})),c.apply(this,arguments)}},d26a:function(e,t,n){"use strict";n.r(t),n.d(t,"Decrypt",function(){return u});n("28a5"),n("34ef"),n("7f7f"),n("96cf");var r=n("d225"),a=n("b0b4"),i=n("3b8d"),o=n("cb96"),c=[[74,214,202,144,103,247,82],[94,149,35,159,19,17,126],[71,116,61,144,170,63,81],[198,9,213,159,250,102,249],[243,214,161,144,160,247,240],[29,149,222,159,132,17,244],[14,116,187,144,188,63,146],[0,9,91,159,98,102,161]],s={mp3:"audio/mpeg",flac:"audio/flac",ogg:"audio/ogg"};function u(e){return l.apply(this,arguments)}function l(){return l=Object(i["a"])(regeneratorRuntime.mark(function e(t){var n,r,a,i,c,u,l,m,d,p,b,h,g,v,y,w,k,x;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:n=t.name.substring(t.name.lastIndexOf(".")+1,t.name.length).toLowerCase(),e.t0=n,e.next="qmc0"===e.t0?4:"qmc3"===e.t0?4:"qmcogg"===e.t0?6:"qmcflac"===e.t0?8:10;break;case 4:return r="mp3",e.abrupt("break",11);case 6:return r="ogg",e.abrupt("break",11);case 8:return r="flac",e.abrupt("break",11);case 10:return e.abrupt("return",{status:!1,message:"File type is incorrect!"});case 11:return a=s[r],e.next=14,new Promise(function(e){var n=new FileReader;n.onload=function(t){e(t.target.result)},n.readAsArrayBuffer(t)});case 14:for(i=e.sent,c=new Uint8Array(i),u=c.length,l=new f,m=0;m<u;++m)c[m]^=l.NextMask();return d=new Blob([c],{type:a}),p=URL.createObjectURL(d),e.next=23,o.parseBlob(d);case 23:return b=e.sent,h=t.name.substring(0,t.name.lastIndexOf(".")).split("-"),g=b.common.title,v=b.common.artist,h.length>1?(void 0===v&&(v=h[0].trim()),void 0===g&&(g=h[1].trim())):1===h.length&&void 0===g&&(g=h[0].trim()),y=v+" - "+g+"."+r,w="",void 0!==b.common.picture&&b.common.picture.length>=1&&(k=b.common.picture[0],x=new Blob([k.data],{type:k.format}),w=URL.createObjectURL(x)),e.abrupt("return",{status:!0,filename:y,title:g,artist:v,album:b.common.album,picture:w,file:p,mime:a});case 32:case"end":return e.stop()}},e)})),l.apply(this,arguments)}var f=function(){function e(){Object(r["a"])(this,e),this.x=-1,this.y=8,this.dx=1,this.index=-1}return Object(a["a"])(e,[{key:"NextMask",value:function(){var e;return this.index++,this.x<0?(this.dx=1,this.y=(8-this.y)%8,e=195):this.x>6?(this.dx=-1,this.y=7-this.y,e=216):e=c[this.y][this.x],this.x+=this.dx,32768===this.index||this.index>32768&&(this.index+1)%32768===0?this.NextMask():e}}]),e}()}});